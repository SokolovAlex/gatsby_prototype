<div ng-if="ngDialogData.isPopupOpen">
  <div id="hmc-modal" ng-class="[ ngDialogData.stateClass, ngDialogData.step.stateClass, { 'hmc-auto-popup-base' : ngDialogData.step.autoPopup === true } ]" class="white-popup hmc-template-v2 hmc-start-screen">
      <div class="modal-header modal-header-no-steps">
        <a data-hmc-action="back" ng-hide="ngDialogData.step.stateClass === 'hmc-modal-step1'" href="#" ng-click="ngDialogData.backBtn($event)" class="modal-button modal-back show-back"><span class="font-icons icon-arrow-left"></span><span class="text">{{::ngDialogData.hmcUI.hmcUIBackText}}</span></a>
        <a ng-click="closeThisDialog(); $event.preventDefault()" href="#" class="modal-button modal-close"><span class="font-icons icon-cancel"></span></a>
      </div>

      <div class="narrow-modal">
        <div class="modal-main modal-promo-popup image-bg">
          <div class="container text-center">
            <div class="section-headline big-headline">
              <hmc-promo-description ng-bind-html="::ngDialogData.step1.hmcPromo.hmcPromoDescription"></hmc-promo-description>
              <hmc-promo-banner ng-bind-html="::ngDialogData.step1.hmcPromo.hmcPromoBanner"></hmc-promo-banner>
            </div>
            <p><a ng-click="ngDialogData.closePromoBanner()" class="button red">{{::ngDialogData.step1.hmcPromo.hmcPromoTryNowBtn}}</a></p>
            
            <hmc-promo-bottom ng-bind-html="::ngDialogData.step1.hmcPromo.hmcPromoBottom"></hmc-promo-bottom>
          </div>
        </div>
      </div>

      <div class="hmc-main">
        <div class="container">
          <div class="hmc-section variant-3">

            <!-- hmc steps start -->

            <div ng-if="ngDialogData.step.currentStep === 'step-1'" class="hmc-desc text-center">
              <hmc-steps ng-bind-html="::ngDialogData.step1.hmcStep1Subtitle"></hmc-steps>
              <hmc-title ng-bind-html="::ngDialogData.step1.hmcStep1LabelTitle"></hmc-title>
            </div>

            <div ng-if="ngDialogData.step.currentStep === 'step-2'" class="hmc-desc text-center">
              <hmc-steps ng-bind-html="::ngDialogData.step2.hmcStep2Subtitle"></hmc-steps>
              <hmc-title ng-bind-html="::ngDialogData.step2.hmcStep2LabelTitle"></hmc-title>
            </div>

            <div class="hmc-picker hmc-select hmc-embedded">
              <div ng-if="ngDialogData.step.currentStep === 'step-1'" class="current-step hmc-step-1">
                <!-- step 1 -->

                <form id="hmc-devices-form" class="required narrow-wrapper" action="#">
                  <div id="hmc-os-selection" class="row">
                    <div ng-click="ngDialogData.selectCheckbox($event)"
                         data-hmc-action="os-selection"
                         ng-repeat="OS in ::ngDialogData.step1.hmcOSSelect"
                         class="form-element checkbox col-6 col-l-3">
                      <input type="checkbox" ng-attr-name="{{OS.hmcOSId}}" ng-attr-value="{{OS.hmcOSId}}" ng-attr-id="{{OS.hmcOSId}}">
                      <label ng-attr-for="{{OS.hmcOSId}}" class="hmc-pick"><span class="hmc-pick-container"><span ng-class="OS.hmcOsClassName" class="font-icons"></span>{{OS.hmcOS}}</span></label>
                    </div>
                  </div>

                  <div class="form-footer hmc-form-footer">
                    <div class="text-center">
                      <p><a href ng-click="ngDialogData.selectAll($event)">{{::ngDialogData.hmcUI.hmcUISelectAllText || 'Select All'}}</a></p>

                      <div class="form-element">
                        <button 
                          data-hmc-action="start"
                          ng-click="ngDialogData.getSelectedOS($event)"
                          type="submit"
                          href="#"
                          ng-disabled="!(ngDialogData.requiredOptionActive || ngDialogData.allSelected)"
                          class="button red hmc-next-button">{{::ngDialogData.hmcUI.hmcUIStartText}}
                        </button>
                      </div>
                    </div>
                  </div>

                </form>

                <!-- step 1 end -->
              </div>

              <div ng-if="ngDialogData.step.currentStep === 'step-2'" class="current-step hmc-step-2">

                <!-- step 2 -->

                <form action="#" class="narrow-wrapper">
                  <div id="hmc-questions-selection" class="form-element-group">

                    <div ng-click="ngDialogData.selectCheckbox($event)" ng-repeat="question in ::ngDialogData.step2.hmcQuestionBlocks" ng-class="{'select-all' : question.hmcQuestionClassName.includes('select-all')}" data-hmc-action="question-selection" class="form-element checkbox">
                      <input type="checkbox" ng-attr-value="{{question.hmcQuestionId}}" ng-attr-name="{{question.hmcQuestionId}}">
                      <label ng-class="question.hmcQuestionClassName" ng-attr-for="{{question.hmcQuestionId}}" data-test="hmc-cta--{{question.hmcQuestionId}}">{{question.hmcQuestion}}</label>
                    </div>

                  </div>

                  <div class="form-footer hmc-form-footer">
                    <div class="text-center">
                      <div class="form-element">
                        <button data-hmc-action="next" ng-click="ngDialogData.checkQuestions($event)" type="submit" class="button red" ng-attr-value="{{ngDialogData.hmcUI.hmcUINextText}}">{{::ngDialogData.hmcUI.hmcUINextText}}</button>
                      </div>
                    </div>
                  </div>

                </form>

                <!-- step 2 end -->

              </div>
            </div>

            <!-- results -->

            <div ng-if="ngDialogData.step.currentStep === 'results'" class="current-step hmc-verdict">
              <h3 class="section-title">{{ngDialogData.hmcUI.hmcResultsTitle || ngDialogData.step1.hmcStep1Title}}</h3>

              <p ng-if="ngDialogData.hmcVerdict.length === 1" class="section-desc" ng-bind-html="ngDialogData.hmcUI.hmcResults1upSubtitle"></p>
              <p ng-if="ngDialogData.hmcVerdict.length > 1" class="section-desc" ng-bind-html="ngDialogData.hmcUI.hmcResults2upSubtitle"></p>

              <div ng-if="ngDialogData.hmcVerdict.length > 1" ng-switch="ngDialogData.kscAvailable && ngDialogData.hmcVerdict.length === 3 && ngDialogData.hmcVerdict[ngDialogData.hmcVerdict.length - 1].shortName !== 'kpm'">
                <div ng-switch-when="true" class="hmc-result" ng-if="ngDialogData.kscAvailable && ngDialogData.hmcVerdict.length === 3 && ngDialogData.hmcVerdict[ngDialogData.hmcVerdict.length - 1].shortName !== 'kpm'">
                  <section class="featured-section">
                    <div class="row">
                      <div class="col-l-8">
                        <ul class="product-list section-col-l-2 no-gutter">
                          <li ng-repeat="product in ngDialogData.hmcVerdict | limitTo:2:0">
                            <div class="product-item product-small">
                              <header class="divider">
                                <figure>
                                  <a ng-href="{{product.learnMoreLink}}">
                                    <img ng-src="{{product.fullSizeImage | addLocalRoot}}" ng-attr-title="{{product.prodMainTitle}}" ng-attr-alt="{{product.prodMainTitle}}" />
                                  </a>
                                </figure>
                                <div class="tagline"><p>{{product.summary}}</p></div>
                                <h2 class="product-title">
                                  <a ng-href="{{product.learnMoreLink}}">
                                    <span ng-bind-html="product.prodKasperskyTitle | html" class="surtitle"></span>
                                    <span>{{product.prodMainTitle}}</span>
                                    <span class="subtitle">{{product.prodAddTitle || '&nbsp;'}}</span>
                                  </a>
                                </h2>
                              </header>
                              <div data-mh="desc-divider" class="desc divider">
                                <p ng-bind-html="product.shortDesc | html"></p>
                                <div class="meta reviews">
                                  <bazaarvoice ng-if="product.bvId" product-id="{{product.bvId}}"></bazaarvoice>
                                </div>
                              </div>

                              <buyblock-radio
                                selected-pack="{{product.selectedDevices}}"
                                selected-term="1"
                                product-name="{{product.shortName}}"
                                component="{{ngDialogData.component}}"
                                template="hmc"
                                selected-autorenew="{{ngDialogData.data.hmc_bb_autorenew[0] || 'false'}}"
                                >
                              </buyblock-radio>
                            </div><!-- /product-item -->
                          </li>
                        </ul>
                      </div>

                      <div class="col-l-4">
                        <ul class="product-list">
                          <li ng-repeat="product in ngDialogData.hmcVerdict | limitTo:1:2">
                            <div class="product-item product-small" ng-class="{'featured-item' : $last && product.shortName !== 'kpm'}">
                              <div ng-if="product.shortName !== 'kpm'" class="promoline"><p>{{ngDialogData.hmcUI.hmcUIRecommendedText}}</p></div>
                              <header class="divider">
                                <figure>
                                  <a ng-href="{{product.learnMoreLink}}">
                                    <img ng-src="{{product.fullSizeImage | addLocalRoot}}" ng-attr-title="{{product.prodMainTitle}}" ng-attr-alt="{{product.prodMainTitle}}" />
                                  </a>
                                </figure>
                                <div ng-class="{'red' : product.shortName !== 'kpm'}" class="tagline">
                                  <p>{{product.summary}}</p>
                                </div>
                                <h2 class="product-title">
                                  <a ng-href="{{product.learnMoreLink}}">
                                    <span class="surtitle">{{product.prodKasperskyTitle}}</span>
                                    <span>{{product.prodMainTitle}}</span>
                                    <span class="subtitle">{{product.prodAddTitle || '&nbsp;'}}</span>
                                  </a>
                                </h2>
                              </header>
                              <div data-mh="desc-divider" class="desc divider">
                                <p ng-bind-html="product.shortDesc">{{product.shortDesc | html}}</p>
                                <div class="meta reviews">
                                  <bazaarvoice ng-if="product.bvId" product-id="{{product.bvId}}"></bazaarvoice>
                                </div>
                              </div>

                              <buyblock-radio
                                highlighted="{{$last && product.shortName !== 'kpm'? true : false}}"
                                selected-pack="{{product.selectedDevices}}"
                                selected-term="1"
                                product-name="{{product.shortName}}"
                                component="{{ngDialogData.component}}"
                                template="hmc"
                                selected-autorenew="{{ngDialogData.data.hmc_bb_autorenew[0] || 'false'}}"
                                >
                              </buyblock-radio><!-- /buy-block -->
                            </div><!-- /product-item -->
                          </li>
                        </ul>
                      </div>
                    </div>
                  </section>

                  <hmc-reviews></hmc-reviews>
                </div>

                <div ng-switch-default class="hmc-result">
                  <section class="featured-section">
                    <ul class="product-list no-gutter{{' section-col-l-' + ngDialogData.hmcVerdict.length}}">
                      <li ng-if="product" ng-repeat="product in ngDialogData.hmcVerdict track by $index">
                        <div class="product-item product-small" ng-class="{'featured-item' : $last && product.shortName !== 'kpm'}">
                          <div ng-if="$last && product.shortName !== 'kpm'" class="promoline">
                            <p>{{ngDialogData.hmcUI.hmcUIRecommendedText}}</p>
                          </div>

                          <header class="divider">
                            <figure>
                              <a ng-href="{{product.learnMoreLink}}">
                                <img ng-src="{{product.fullSizeImage | addLocalRoot}}" ng-attr-title="{{product.prodMainTitle}}" ng-attr-alt="{{product.prodMainTitle}}" />
                              </a>
                            </figure>

                            <div class="tagline">
                              <p>{{product.summary}}</p>
                            </div>
                            <h2 class="product-title">
                              <a ng-href="{{product.learnMoreLink}}">
                                <span ng-bind-html="product.prodKasperskyTitle | html" class="surtitle"></span>
                                <span>{{product.prodMainTitle}}</span>
                                <span class="subtitle">{{product.prodAddTitle || '&nbsp;'}}</span>
                              </a>
                            </h2>
                          </header>

                          <div data-mh="desc-divider" class="desc divider">
                            <p ng-bind-html="product.shortDesc | html"></p>
                            <div class="meta reviews">
                              <bazaarvoice ng-if="product.bvId" product-id="{{product.bvId}}"></bazaarvoice>
                            </div>
                          </div>

                          <buyblock-radio
                            highlighted="{{$last && product.shortName !== 'kpm' ? true : false}}"
                            selected-pack="{{product.selectedDevices}}"
                            selected-term="1"
                            product-name="{{product.shortName}}"
                            component="{{ngDialogData.component}}"
                            template="hmc"
                            selected-autorenew="{{ngDialogData.data.hmc_bb_autorenew[0] || 'false'}}"
                            >
                          </buyblock-radio>
                        </div><!-- /product-item -->
                      </li>
                    </ul>
                  </section><!-- /featured-section -->

                  <hmc-reviews></hmc-reviews>
                </div>
              </div>

              <div class="hmc-result" ng-if="ngDialogData.hmcVerdict.length === 1">
                <div class="featured-section">
                  <ul class="product-list">
                    <li>
                      <div class="product-item horizontal-item">
                        <div class="row">
                          <div class="col-l-7">
                            <header>
                              <figure>
                                <a ng-href="{{::ngDialogData.hmcVerdict[0].learnMoreLink}}">
                                  <img ng-src="{{ngDialogData.hmcVerdict[0].fullSizeImage}}" ng-attr-title="{{ngDialogData.hmcVerdict[0].fullSizeImage}}" ng-attr-alt="{{ngDialogData.hmcVerdict[0].prodMainTitle}}" />
                                </a>
                              </figure>
                              <h2 class="product-title">
                                <a ng-href="{{::ngDialogData.hmcVerdict[0].learnMoreLink}}">
                                  <span class="surtitle">{{::ngDialogData.hmcVerdict[0].prodKasperskyTitle}}</span>
                                  <span>{{::ngDialogData.hmcVerdict[0].prodMainTitle}}</span>
                                  <span class="subtitle">{{::ngDialogData.hmcVerdict[0].prodAddTitle}}</span>
                                </a>
                              </h2>
                              <div class="desc" ng-bind-html="ngDialogData.hmcVerdict[0].description"></div>
                            </header>
                          </div>
                          <div class="col-l-4 shift-l-1 text-right">
                            <buyblock-radio
                              selected-pack="{{ngDialogData.hmcVerdict[0].selectedDevices}}"
                              selected-term="1 Year"
                              product-name="{{ngDialogData.hmcVerdict[0].shortName}}"
                              component="{{ngDialogData.component}}"
                              template="hmc-1up-v2"
                              selected-autorenew="{{ngDialogData.data.hmc_bb_autorenew[0] || 'false'}}"
                              >
                            </buyblock-radio><!-- /buy-block -->
                          </div>
                        </div>
                      </div><!-- /product-item -->
                    </li>
                  </ul>
                </div>
                <hmc-reviews></hmc-reviews>
              </div>
            </div>

            <!-- hmc steps end -->

          </div>
        </div>
      </div>
  </div>
</div>
